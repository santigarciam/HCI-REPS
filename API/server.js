'use strict';const _0x2656=['queryByFilter','public','23491BAuMJm','1366700PbrrFd','./config/mailing','760176vvWvDd','Strategy','PORT','swaggerMetadata','development','swaggerUi','secure','api/swagger.yaml','env','99477YXVRqM','locals','readFileSync','ExtractJwt','join','swaggerRouter','mailingTransporter','create','iat','./knex/knex.js','utf8','Session','fromAuthHeaderAsBearerToken','JWT_SECRET','./repository/RepositoryFactory','log','initialize','968196vdDRSU','dotenv','user','host','./middleware/error_handler','nodemailer','use','initializeMiddleware','291186ILYOOC','38jkjNVV','passport','config','port','sub','cors','swaggerValidator','./controllers','./middleware/auth_handler','path','NODE_ENV','./middleware/user_activity_handler','log_iat','User','migrate','./middleware/swagger_validator_handler','queryById','1207677DYcvka','static','js-yaml','createTransport','latest'];const _0x2e829c=_0x56d7;(function(_0x54b682,_0x15edca){const _0x54f789=_0x56d7;while(!![]){try{const _0x2208be=-parseInt(_0x54f789(0xf9))+parseInt(_0x54f789(0x124))+parseInt(_0x54f789(0xed))*parseInt(_0x54f789(0x113))+-parseInt(_0x54f789(0x10a))+parseInt(_0x54f789(0xf0))+parseInt(_0x54f789(0x112))+-parseInt(_0x54f789(0xee));if(_0x2208be===_0x15edca)break;else _0x54b682['push'](_0x54b682['shift']());}catch(_0x542e36){_0x54b682['push'](_0x54b682['shift']());}}}(_0x2656,0xaf20c));function _0x56d7(_0x211a25,_0x37e6ad){_0x211a25=_0x211a25-0xe9;let _0x265624=_0x2656[_0x211a25];return _0x265624;}require(_0x2e829c(0x10b))[_0x2e829c(0x115)]();const passport=require(_0x2e829c(0x114)),passportJWT=require('passport-jwt'),ExtractJWT=passportJWT[_0x2e829c(0xfc)],JwtStrategy=passportJWT[_0x2e829c(0xf1)],passportOpts={'jwtFromRequest':ExtractJWT[_0x2e829c(0x105)](),'secretOrKey':process[_0x2e829c(0xf8)][_0x2e829c(0x106)]},fs=require('fs'),path=require(_0x2e829c(0x11c)),express=require('express');var app=express();const swaggerTools=require('swagger-tools'),jsyaml=require(_0x2e829c(0x126)),options={'swaggerUi':path[_0x2e829c(0xfd)](__dirname,'/swagger.json'),'controllers':path[_0x2e829c(0xfd)](__dirname,_0x2e829c(0x11a)),'useStubs':process['env']['NODE_ENV']===_0x2e829c(0xf4)};var spec=fs[_0x2e829c(0xfb)](path[_0x2e829c(0xfd)](__dirname,_0x2e829c(0xf7)),_0x2e829c(0x103)),swaggerDoc=jsyaml['safeLoad'](spec);const knex=require(_0x2e829c(0x102)),{RepositoryName,RepositoryFactory}=require(_0x2e829c(0x107));RepositoryFactory[_0x2e829c(0x109)](knex);process[_0x2e829c(0xf8)][_0x2e829c(0x11d)]!=='test'&&knex[_0x2e829c(0x121)][_0x2e829c(0xea)]();const nodemailer=require(_0x2e829c(0x10f)),{service}=require(_0x2e829c(0xef)),transporter=nodemailer[_0x2e829c(0xe9)]({'host':service[_0x2e829c(0x10d)],'port':service[_0x2e829c(0x116)],'secure':service[_0x2e829c(0xf6)],'auth':{'user':service[_0x2e829c(0x10c)],'pass':service['password']}});transporter['verify'](function(_0xa003b9,_0x27ed0f){const _0x243394=_0x2e829c;_0xa003b9?console[_0x243394(0x108)](_0xa003b9):console[_0x243394(0x108)]('Server\x20is\x20ready\x20to\x20take\x20our\x20messages');}),app[_0x2e829c(0xfa)][_0x2e829c(0xff)]=transporter;const cors=require(_0x2e829c(0x118)),swaggerValidatorHandler=require(_0x2e829c(0x122)),userActivityHandler=require(_0x2e829c(0x11e)),errorHandler=require(_0x2e829c(0x10e));swaggerTools[_0x2e829c(0x111)](swaggerDoc,function(_0xd67d3){const _0x25a0d7=_0x2e829c;app['use'](express[_0x25a0d7(0x125)](_0x25a0d7(0xec))),app['use'](_0xd67d3[_0x25a0d7(0xf3)]()),app['use'](cors()),passport[_0x25a0d7(0x110)](new JwtStrategy(passportOpts,async function(_0x3d8b55,_0x618d30){const _0x3a85c1=_0x25a0d7,_0xd7d199=RepositoryFactory[_0x3a85c1(0x100)](RepositoryName[_0x3a85c1(0x104)]),_0xdf95b4=_0xd7d199[_0x3a85c1(0xeb)]({'userId':_0x3d8b55['sub'],'iat':_0x3d8b55['iat']});if(!_0xdf95b4)return _0x618d30(null,![]);const _0x51c808=RepositoryFactory[_0x3a85c1(0x100)](RepositoryName[_0x3a85c1(0x120)]);let _0x362b2b=await _0x51c808[_0x3a85c1(0x123)](_0x3d8b55[_0x3a85c1(0x117)]);return _0x362b2b?(_0x362b2b[_0x3a85c1(0x11f)]=_0x3d8b55[_0x3a85c1(0x101)],_0x618d30(null,_0x362b2b)):_0x618d30(null,![]);}));const _0x59f827=require(_0x25a0d7(0x11b))(passport);app[_0x25a0d7(0x110)](passport['initialize']()),app[_0x25a0d7(0x110)](_0x59f827),app[_0x25a0d7(0x110)](userActivityHandler()),app['use'](_0xd67d3[_0x25a0d7(0x119)]({'validateResponse':![]})),app[_0x25a0d7(0x110)](swaggerValidatorHandler),app[_0x25a0d7(0x110)](_0xd67d3[_0x25a0d7(0xfe)](options)),app[_0x25a0d7(0x110)](_0xd67d3[_0x25a0d7(0xf5)]()),app[_0x25a0d7(0x110)](errorHandler),app['listen'](process[_0x25a0d7(0xf8)][_0x25a0d7(0xf2)]||0x1f90,function(){const _0x27365f=_0x25a0d7;console[_0x27365f(0x108)]('Swagger-ui\x20is\x20available\x20on\x20http://localhost:%d/docs',process['env'][_0x27365f(0xf2)]);});}),module['exports']=app;